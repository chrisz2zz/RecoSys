### 1. 前言

- 最近在读**Python深度学习**这本书，本文记录一下书里面的讲的很清楚的**张量**。

- 在机器学习中，数据大多存储在多维的Numpy数组中，也叫**张量**。
- **张量**的核心在于，它是一个数据容器。包含的数据总是数值数据，是数字的容器。例如矩阵，它是二维张量，张量是矩阵向任意维度的推广（**张量的维度通常叫做轴 axis**）。

### 2. 标量（0D张量）

- **仅包含一个数字的张量叫作标量**(scalar，也叫标量张量、零维张量、0D 张量)。
- 在 Numpy中，一个 float32 或 float64 的数字就是一个标量张量(或标量数组)。
- 我们可以使用`ndim`属性来查看一个numpy张量的轴的个数。**标量张量有0个轴，即ndim==0**。
- 张量轴的个数也可以叫做阶（rank）。

```python
import numpy as np 
x = np.array(12) 
>>> x
array(12)
>>> x.ndim 
0
```

### 3. 向量（1D张量）

- **数字组成的数组叫做向量（vector）**或一维张量（1D张量）。
- 一维张量只有一个轴。

```python
>>> x = np.array([12, 3, 6, 14, 7]) 
>>> x
array([12, 3, 6, 14, 7])
>>> x.ndim
1
```

- 这个向量有 5 个元素，所以被称为 5D 向量。
- **不要把 5D 向量和 5D 张量弄混，5D 向量只 有一个轴，沿着轴有 5 个维度，而 5D 张量有 5 个轴(沿着每个轴可能有任意个维度)。**
- 维度(dimensionality)可以表示沿着某个轴上的元素个数(比如 5D 向量)，也可以表示张量中轴的个 数(比如 5D 张量)，这有时会令人感到混乱。
- 对于后一种情况，技术上更准确的说法是 5 阶张量，(张量的阶数即轴的个数)，但 5D 张量这种模糊的写法更常见。

### 4. 矩阵（2D张量）

- **向量组成的数组叫作矩阵(matrix)或二维张量(2D 张量)。**
- **矩阵有 2 个轴(通常叫作行和列)。**可以将矩阵直观地理解为数字组成的矩形网格。

```python
>>> x = np.array([[5, 78, 2, 34, 0], 
									[6, 79, 3, 35, 1],
									[7, 80, 4, 36, 2]])
>>> x.ndim 
2
```

- 第一个轴上的元素叫作行(row)，第二个轴上的元素叫作列(column)。在上面的例子中，[5, 78, 2, 34, 0] 是 x 的第一行，[5, 6, 7] 是第一列。

### 5. 3D张量和更高维张量

- **将多个矩阵组合成一个新的数组，可以得到一个 3D 张量，可以将其直观地理解为数字组成的立方体。**下面是一个 Numpy 的 3D 张量。

```python
x = np.array([[[5, 78, 2, 34, 0], 
							 [6, 79, 3, 35, 1],
							 [7, 80, 4, 36, 2]],
						  [[4, 78, 2, 34, 0], 
							 [3, 79, 3, 35, 1],
							 [2, 80, 4, 36, 2]],
						  [[5, 78, 2, 34, 0], 
							 [6, 79, 3, 35, 1],
							 [7, 80, 4, 36, 2]]])
print (x.ndim)

# 3
```

- **将多个 3D 张量组合成一个数组，可以创建一个 4D 张量，以此类推。**

### 6. 张量属性

#### 6.1 轴的个数（阶）

- 例如，3D 张量有 3 个轴，矩阵有 2 个轴。这在 Numpy 等 Python 库中 也叫张量的 ndim。

#### 6.2 形状

- 这是一个整数元组，表示张量沿每个轴的维度大小(元素个数)。例如，前面矩阵示例的形状为 (3, 5)，3D 张量示例的形状为 (3, 3, 5)。向量的形状只包含一个元素，比如 (5,)，而标量的形状为空，即 ()。

#### 6.3 数据类型

- 这是张量中所包含数据的类型，例如，张量的类型可以是 float32、uint8、float64 等。
- 在极少数情况下，你可能会遇到字符 (char)张量。注意，Numpy(以及大多数其他库)中不存在字符串张量，因为张量存储在预先分配的连续内存段中，而字符串的长度是可变的，无法用这种方式存储。

### 7. 张量切片操作

- **选择张量的特定元素叫作张量切片(tensor slicing)**。

- 下面这个例子选择第 10~100 个数字(不包括第 100 个)，并将其放在形状为 (90, 28, 28) 的数组中。

```python
>>> my_slice = train_images[10:100] 
>>> print(my_slice.shape)
(90, 28, 28)
```

- 它等同于下面这个更复杂的写法，**给出了切片沿着每个张量轴的起始索引和结束索引**。 
- **注意，: 等同于选择整个轴。**

```python
>>> my_slice = train_images[10:100, :, :]
>>> my_slice.shape
(90, 28, 28)
>>> my_slice = train_images[10:100, 0:28, 0:28] 
>>> my_slice.shape
(90, 28, 28)
```

- 可以沿着每个张量轴在任意两个索引之间进行选择。例如，可以在所有图像的右下角选出 14 像素×14 像素的区域:

```python
my_slice = train_images[:, 14:, 14:]
```

- 也可以使用负数索引。与 Python 列表中的负数索引类似，它表示与当前轴终点的相对位置。 可以在图像中心裁剪出 14 像素×14 像素的区域:

```python
my_slice = train_images[:, 7:-7, 7:-7]
```

### 8. 数据批量

- 通常来说，深度学习中**所有数据张量的第一个轴(0 轴，因为索引从 0 开始)都是样本轴** ****(samples axis，有时也叫样本维度)。在 MNIST 的例子中，样本就是数字图像。
- 此外，深度学习模型不会同时处理整个数据集，而是将数据拆分成小批量。具体来看，下 面是 MNIST 数据集的一个批量，批量大小为 128。

```python
batch = train_images[:128]
# 然后是下一个批量。
batch = train_images[128:256]
# 然后是第 n 个批量。
batch = train_images[128 * n:128 * (n + 1)]
```

### 9. 图像数据

- **图像通常具有三个维度: 高度、宽度和颜色深度。**
- 虽然灰度图像(比如 MNIST 数字图像) 只有一个颜色通道，因此可以保存在 2D 张量中，但按照惯例，图像张量始终都是 3D 张量，**灰度图像的彩色通道只有一维**。因此，如果图像大小为 256×256，那么 128 张灰度图像组成的批 量可以保存在一个形状为 (128, 256, 256, 1) 的张量中。
-  128 张彩色图像组成的批量则可以保存在一个形状为 (128, 256, 256, 3) 的张量中，如下图：

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/CNN/21-1.jpg)

- 图像张量的形状有两种约定：**通道在后（channels-last）的约定（在 TensorFlow 中使用）和通道在前（channels-first）的约定（在 Theano 中使用）。**
- Google 的 TensorFlow 机器学习框架将 颜色深度轴放在最后:(samples, height, width, color_depth)。与此相反，Theano将图像深度轴放在批量轴之后:(samples, color_depth, height, width)。
- 如果采用 Theano 约定，前面的两个例子将变成 (128, 1, 256, 256) 和 (128, 3, 256, 256)。 Keras 框架同时支持这两种格式。