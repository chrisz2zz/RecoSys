### 前言

- 逻辑回归模型表达能力不强的问题会**导致有效信息的损失**
- 在仅使用单一特征而非交叉特征进行判断的情况下，有时不仅是信息损失的问题，禁止会得出错误的结论

### 辛普森悖论

- 在分组比较中都占优势的一方，在总评时有时反而是失势的一方，这种现象称为辛普森悖论。
- 详见下方例子：

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-1.jpeg)

- 逻辑回归只对单一特征进行简单加权，不具备进行**特征交叉生成高维组合特征**的能力，因此表达能力很弱，甚至会得出”辛普森悖论“的错误结论，因此，需要改造逻辑回归模型，使其具备特征交叉能力。

### 1. POLY2模型：特征交叉的开始

- 特征的暴力组合，公式如下：

$$
POLY2(w,x) = \sum_{j_1=1}^{n-1}\sum_{j_2=j_1+1}^{n}w_{h(j_1,j_2)}x_{j_1}x_{j_2}
$$

- 如上式所示，模型对所有特征进行了两两交叉$x_{j_1}x_{j_2}$。并对所有的特征组合赋予了权重$w_{h(j_1,j_2)}$。通过暴力组合特征的方式，一定程度上解决了特征组合的问题。
- 两大缺陷：
  - 处理互联网数据时，**经常采用one-hot的编码方式处理类别型数据，致使特征向量极度稀疏。POLY2进行无选择的特征交叉，原本就稀疏的特征向量更加稀疏**，导致缺乏有效数据训练，无法收敛。
  - 权重参数的数量有n上升到$n^2$，极大的**增加了训练复杂度**。
- one-hot编码如下简介：举例来说，某样本有三个特征，星期、性别和城市，用[Weekday=Tuesday,Gender=Male,City=London]表示。由于输入特征向量仅可以使数字型特征向量

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-2.jpeg)

### 2. FM模型

- FM公式如下，与POLY2相比，主要区别是用两个向量的内积 $(w_{j_1} \cdot w_{j_2})$取代了单一的权重系数$(w_{h(j_1,j_2)})$
- 具体来说，**FM为每个特征学习了一个隐权重向量，在特征交叉时，使用两个特征隐向量的内积作为交叉特征的权重。**

$$
FM(w,x) = \sum_{j_1=1}^{n-1}\sum_{j_2=j_1+1}^{n}(w_{j_1} \cdot w_{j_2})x_{j_1}x_{j_2}
$$

- FM引入隐向量的做法，类似**矩阵分解用隐向量代表用户和物品的做法，从单纯的用户、物品隐向量扩展到了全部的特征。**

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-3.jpeg)

### 3. FFM模型：引入特征域

- 2015年，基于FM提出的FFM在多项CTR预估大赛中夺魁。相比FM，FFM模型提出了**特征域感知**概念。

$$
FFM(w,x) = \sum_{j_1=1}^{n-1}\sum_{j_2=j_1+1}^{n}(w_{j_1,f_2} \cdot w_{j_2,f_1})x_{j_1}x_{j_2}
$$

- 与FM的区别：隐向量由之前的$w_{j_1}$变成了$w_{j_1,f_2}$，即：**每个特征对应的不是唯一一个隐向量，而是一组隐向量。**当$x_{j_1}$特征与$x_{j_2}$特征进行交叉时，$x_{j_1}$特征会从$x_{j_1}$的一组隐向量中挑出与特征$x_{j_2}$的域$f_2$对应的隐向量$w_{j_1,f_2}$进行交叉。同理，$x_{j_2}$特征会从$x_{j_2}$的一组隐向量中挑出与特征$x_{j_1}$的域$f_1$对应的隐向量进行交叉。

- 对**特征域的解释：**

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-4.jpeg)

### 4. 从POLY2到FFM的模型演化

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-5.jpeg)

![](https://blog-1258986886.cos.ap-beijing.myqcloud.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/5-6.jpeg)

